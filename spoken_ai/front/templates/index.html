<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI 口语教练 · 沉浸式首页</title>

<!-- 谷歌图标 & 思源黑体 -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet"/>

<style>
:root{
  --bg:linear-gradient(135deg,#f5f7fa 0%, #c3cfe2 100%);
  --card-bg:rgba(255,255,255,.50);
  --text:#1c1e21;
  --primary:#6750a4;
  --radius:24px;
  --shadow:0 8px 32px rgba(0,0,0,.12);
  --blur:20px;
}
[data-theme="dark"]{
  --bg:linear-gradient(135deg,#1e1e2e 0%, #302b63 100%);
  --card-bg:rgba(30,30,46,.50);
  --text:#e2e8f0;
  --primary:#a78bfa;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans SC',sans-serif;}
body{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg);transition:.4s;}

/* 顶部区域 */
header{
  width:100%;
  padding:24px 48px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{
  font-size:26px;
  font-weight:700;
  color:var(--text);
  letter-spacing:1px;
}

/* 右侧：主题开关 + 登录区域 */
.header-right{
  display:flex;
  align-items:center;
  gap:16px;
}

#themeToggle{
  background:var(--card-bg);
  border:none;
  color:var(--text);
  cursor:pointer;
  font-size:22px;
  border-radius:999px;
  padding:8px 10px;
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
}

.auth-actions{
  display:flex;
  align-items:center;
  gap:10px;
}

.auth-btn{
  padding:8px 18px;
  border-radius:999px;
  border:1px solid rgba(103,80,164,.25);
  background:var(--card-bg);
  color:var(--text);
  font-size:14px;
  text-decoration:none;
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
  display:flex;
  align-items:center;
  gap:6px;
  transition:.3s;
}
.auth-btn span.material-symbols-rounded{
  font-size:18px;
}
.auth-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 10px 24px rgba(0,0,0,.18);
}

/* 主要按钮（注册） */
.auth-btn.primary{
  background:linear-gradient(135deg,#6750a4,#9f7aea);
  color:#fff;
  border:none;
}

/* 用户信息展示 */
.user-pill{
  padding:8px 14px;
  border-radius:999px;
  background:var(--card-bg);
  border:1px solid rgba(103,80,164,.25);
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
  color:var(--text);
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
}
.user-avatar{
  width:28px;
  height:28px;
  border-radius:50%;
  background:linear-gradient(135deg,#6750a4,#9f7aea);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:16px;
  font-weight:600;
}

/* 搜索框 */
.search-box{
  position:relative;
  margin:16px 0 32px;
  width:clamp(300px,60vw,600px);
}
.search-box input{
  width:100%;
  padding:16px 52px 16px 20px;
  border-radius:var(--radius);
  border:none;
  background:var(--card-bg);
  color:var(--text);
  font-size:16px;
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
}
.search-box .icon{
  position:absolute;
  right:16px;
  top:50%;
  transform:translateY(-50%);
  color:var(--primary);
  cursor:pointer;
  font-size:24px;
}
.suggestion{
  position:absolute;
  top:100%;
  left:0;
  right:0;
  margin-top:4px;
  background:var(--card-bg);
  border-radius:var(--radius);
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
  overflow:hidden;
  display:none;
}
.suggestion li{
  padding:12px 20px;
  cursor:pointer;
  color:var(--text);
}
.suggestion li:hover{
  background:rgba(103,80,164,.15);
}

/* 卡片网格 */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:32px;
  padding:0 48px 48px;
  width:100%;
  max-width:1200px;
}
.card{
  position:relative;
  height:200px;
  border-radius:var(--radius);
  background:var(--card-bg);
  color:var(--text);
  overflow:hidden;
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
  display:flex;
  align-items:flex-end;
  padding:24px;
  transition:transform .4s;
  text-decoration:none;
}
.card:hover{
  transform:rotateY(-5deg) scale(1.03);
}
.card .icon{
  font-size:48px;
  color:var(--primary);
  position:absolute;
  top:24px;
  left:24px;
}
.card h3{
  font-size:22px;
  font-weight:600;
  margin-bottom:4px;
}
.card p{
  font-size:14px;
  opacity:.8;
}
.card-bg{
  position:absolute;
  inset:0;
  border-radius:inherit;
  background:linear-gradient(135deg,var(--primary),#9f7aea);
  opacity:.15;
  transition:opacity .4s;
}
.card:hover .card-bg{
  opacity:.25;
}

/* 登录提示弹窗 */
.auth-modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.40);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
.auth-modal{
  width:clamp(280px,90vw,360px);
  background:var(--card-bg);
  border-radius:20px;
  padding:22px 20px 18px;
  backdrop-filter:blur(var(--blur));
  box-shadow:var(--shadow);
  position:relative;
}
.auth-modal h2{
  font-size:18px;
  margin-bottom:6px;
  color:var(--text);
}
.auth-modal p{
  font-size:14px;
  color:var(--text);
  opacity:.85;
}
.auth-modal-header{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:8px;
}
.auth-modal-icon{
  width:32px;
  height:32px;
  border-radius:12px;
  background:linear-gradient(135deg,#f97316,#ec4899);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
}
.auth-modal-footer{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:16px;
}
.modal-btn{
  padding:8px 14px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-size:13px;
}
.modal-btn.secondary{
  background:transparent;
  border:1px solid rgba(148,163,184,.6);
  color:var(--text);
}
.modal-btn.primary{
  background:linear-gradient(135deg,#6750a4,#9f7aea);
  color:#fff;
}
</style>
</head>

<body {% if request.COOKIES.theme == 'dark' %}data-theme="dark"{% endif %}>
<header>
  <h1>AI 口语教练</h1>

  <div class="header-right">
    <!-- 主题切换 -->
    <button id="themeToggle" aria-label="切换主题">
      <span class="material-symbols-rounded">brightness_4</span>
    </button>

    <!-- 登录 / 注册 / 退出：使用 login_in / username，而不是 user.is_authenticated -->
    <div class="auth-actions">
      {% if login_in %}
        <div class="user-pill">
          <div class="user-avatar">
            {{ username|first|default:"U" }}
          </div>
          <span>欢迎回来，{{ username }}</span>
        </div>
        <a href="{% url 'spoken_ai:logout' %}" class="auth-btn">
          <span class="material-symbols-rounded">logout</span>
          退出
        </a>
      {% else %}
        <a href="{% url 'spoken_ai:login' %}" class="auth-btn">
          <span class="material-symbols-rounded">login</span>
          登录
        </a>
        <a href="{% url 'spoken_ai:register' %}" class="auth-btn primary">
          <span class="material-symbols-rounded">person_add</span>
          注册
        </a>
      {% endif %}
    </div>
  </div>
</header>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="搜索口语场景、功能或词汇…" autocomplete="off"/>
  <span class="icon material-symbols-rounded">search</span>
  <ul class="suggestion" id="suggestionBox"></ul>
</div>

<!-- ========= 功能卡片：全部要求登录后才能进入 ========= -->
<section class="grid">
  <!-- 托福口语 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:toefl_index' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">record_voice_over</span>
    <div class="card-bg"></div>
    <div>
      <h3>托福口语</h3>
      <p>真题模考 · 计时练习 · AI 评分</p>
    </div>
  </a>

  <!-- AI 口语教练 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:spoken_ai' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">smart_toy</span>
    <div class="card-bg"></div>
    <div>
      <h3>AI 口语教练</h3>
      <p>实时纠错 · 发音评分 · 个性化训练</p>
    </div>
  </a>

  <!-- 雅思口语 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:index' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">mic</span>
    <div class="card-bg"></div>
    <div>
      <h3>雅思口语</h3>
      <p>Part 1-3 全题库 · 考官 AI 模拟</p>
    </div>
  </a>

  <!-- 学术交流 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:index' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">forum</span>
    <div class="card-bg"></div>
    <div>
      <h3>学术交流</h3>
      <p>论文答辩 · 会议演讲 · 专业词汇</p>
    </div>
  </a>

  <!-- 旅游出行 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:index' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">travel_explore</span>
    <div class="card-bg"></div>
    <div>
      <h3>旅游出行</h3>
      <p>机场 · 酒店 · 点餐 · 问路</p>
    </div>
  </a>

  <!-- 地道俚语 -->
  <a class="card feature-link" 
     href="{% url 'spoken_ai:index' %}" 
     data-auth-required="true">
    <span class="icon material-symbols-rounded">emoji_emotions</span>
    <div class="card-bg"></div>
    <div>
      <h3>地道俚语</h3>
      <p>每日一句 · 场景例句 · 文化解读</p>
    </div>
  </a>
</section>

<!-- 登录提示弹窗 -->
<div class="auth-modal-backdrop" id="authModalBackdrop">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <div class="auth-modal-icon">
        <span class="material-symbols-rounded" style="font-size:20px;">lock</span>
      </div>
      <div>
        <h2>需要登录后才能使用</h2>
        <p>请先登录账号，再进入口语训练模块。</p>
      </div>
    </div>
    <div class="auth-modal-footer">
      <button class="modal-btn secondary" id="modalCancelBtn">稍后再说</button>
      <a href="{% url 'spoken_ai:login' %}" class="modal-btn primary" id="modalLoginBtn">去登录</a>
    </div>
  </div>
</div>

<script>
/* 用后端变量告诉前端当前登录状态（来自 session: login_in） */
const isAuthenticated = {{ login_in|yesno:"true,false" }};  // True/False -> true/false

/* 1. 主题切换 */
const themeToggle = document.getElementById('themeToggle');
themeToggle.addEventListener('click', () => {
  const isDark = document.body.dataset.theme === 'dark';
  document.body.dataset.theme = isDark ? '' : 'dark';
});

/* 2. 搜索联想 */
const keywords = ["托福口语 Task 1", "雅思 Part 2 话题卡", "AI 纠音", "地道俚语", "旅游对话", "学术交流场景"];
const searchInput = document.getElementById('searchInput');
const suggestionBox = document.getElementById('suggestionBox');

searchInput.addEventListener('input', () => {
  const val = searchInput.value.toLowerCase();
  suggestionBox.innerHTML = '';
  if (!val) { suggestionBox.style.display = 'none'; return; }
  const matches = keywords.filter(k => k.toLowerCase().includes(val));
  if (matches.length) {
    matches.forEach(m => {
      const li = document.createElement('li');
      li.textContent = m;
      li.addEventListener('click', () => {
        searchInput.value = m;
        suggestionBox.style.display = 'none';
      });
      suggestionBox.appendChild(li);
    });
    suggestionBox.style.display = 'block';
  } else {
    suggestionBox.style.display = 'none';
  }
});

document.addEventListener('click', e => {
  if (!e.target.closest('.search-box')) suggestionBox.style.display = 'none';
});

/* 3. 功能卡片：必须登录后才能跳转 */
const featureLinks = document.querySelectorAll('.feature-link[data-auth-required="true"]');
const authModalBackdrop = document.getElementById('authModalBackdrop');
const modalCancelBtn = document.getElementById('modalCancelBtn');

function showAuthModal() {
  authModalBackdrop.style.display = 'flex';
}
function closeAuthModal() {
  authModalBackdrop.style.display = 'none';
}

featureLinks.forEach(link => {
  link.addEventListener('click', function (e) {
    if (!isAuthenticated) {
      e.preventDefault();
      showAuthModal();
    }
  });
});

modalCancelBtn.addEventListener('click', closeAuthModal);
authModalBackdrop.addEventListener('click', (e) => {
  if (e.target === authModalBackdrop) {
    closeAuthModal();
  }
});
</script>
</body>
</html>
